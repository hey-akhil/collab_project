{% extends 'static_pages/base.html' %}
{% load static %}
{% block start %}

<title>Profile - Mehendi Artist</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

<div class="profile-container">
  <!-- Left Column -->
  <div class="profile-left">
    <div class="profile-card">
      <div class="profile-icon">üë©‚Äçüé®</div>
      <h2>{{ user.username }}</h2>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Joined:</strong> {{ user.date_joined|date:"F j, Y" }}</p>

      <div class="profile-actions">
        <a href="{% url 'logout' %}" class="btn-primary">Logout</a>
        <button class="btn-primary" onclick="openModal()">Edit Profile</button>
      </div>
    </div>
  </div>

  <!-- Right Column -->
  <div class="profile-right">
    <div class="orders-section">
      <h4>üßæ Recent Orders</h4>
      {% if recent_orders %}
        {% for order in recent_orders %}
          <div class="order-card">
            <p><strong>Order #{{ order.id }}</strong></p>
            <p>Total: ‚Çπ{{ order.final_total }}</p>
            <p>Date: {{ order.created_at|date:"F j, Y" }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p>No recent orders found.</p>
      {% endif %}
    </div>

    <hr>

    <div class="profile-links">
      <a href="{% url 'cart' %}"><i class="fas fa-shopping-cart"></i> &nbsp; Cart</a>
      <a href="{% url 'myOrders' %}"><i class="fas fa-box-open"></i> &nbsp; My Orders</a>
      <a href="#"><i class="fas fa-ticket-alt"></i> &nbsp; Raise Ticket</a>
      <a href="{% url 'manage_addresses' %}"><i class="fas fa-map-marker-alt"></i>  &nbsp; Save Address</a>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h4 style="margin-bottom: 1rem;">‚úèÔ∏è Edit Profile</h4>
    <form method="post" action="{% url 'edit_profile' %}">
      {% csrf_token %}
      <label for="username">Username:</label>
      <input type="text" name="username" id="username" value="{{ user.username }}" required>

      <label for="email">Email:</label>
      <input type="email" name="email" id="email" value="{{ user.email }}" required>

      <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
  </div>
</div>

<script>
  function openModal() {
    document.getElementById('editModal').style.display = 'block';
  }
  function closeModal() {
    document.getElementById('editModal').style.display = 'none';
  }

  // Optional: Close modal if user clicks outside the form
  window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>

{% endblock %}
