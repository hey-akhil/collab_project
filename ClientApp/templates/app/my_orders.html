{% extends 'static_pages/base.html' %}
{% load static %}
{% block start %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  body {
    background-color: #f5f7fa;
    font-family: Arial, sans-serif;
  }
  .order-card {
    background-color: #fff;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  }
  .order-card h6 {
    font-weight: bold;
  }
  .btn-track {
    background-color: #6cc24a;
    color: #fff;
    border: none;
  }
  .btn-track:hover {
    background-color: #5aa63c;
  }
</style>

<div class="container my-4" style="color: black;">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">My Orders</h4>
        <a href="{% url 'cart' %}" class="btn btn-outline-success btn-sm">
          <i class="bi bi-cart"></i> Back to Cart
        </a>
      </div>
      <small class="text-muted d-block mb-3">{{ orders.count }} orders</small>

      {% if orders %}
        {% for order in orders %}
          <div class="order-card">
            <!-- Order Header -->
            <h6 class="mb-3">
              Order #{{ order.id }} -
              <span class="text-muted">{{ order.created_at|date:"M d, Y H:i" }}</span>
            </h6>

            <!-- Items -->
            {% for item in order.orderitem_set.all %}
              <div class="d-flex justify-content-between mb-2">
                <div>
                  <strong>{{ item.color }}</strong>
                  <span class="text-muted">x{{ item.quantity }}</span>
                </div>
                <div>₹{{ item.line_total }}</div>
              </div>
            {% endfor %}

            <hr>

            <!-- Price Summary -->
            <div class="">
              <span>Subtotal:</span>
              <strong>₹{{ order.total_price }}</strong>
            </div>
            <div class="">
              <span>Shipping:</span>
              <strong>₹{{ order.shipping_charge }}</strong>
            </div>
            <div class="" style="font-size: 1.2rem;">
              <span>Total:</span>
              <strong class="text-danger">₹{{ order.final_total }}</strong>
            </div>

            <hr>

            <!-- Delivery and Actions -->
            <div class="d-flex justify-content-between">
              <div>
                <small>Delivered to:</small><br>
                {{ order.fullname }}, {{ order.address_line1 }}, {{ order.city }}
              </div>
              <div class="text-end">
                <button class="btn btn-outline-primary btn-sm">View Details</button>
                <button class="btn btn-link btn-sm">Get Invoice</button>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted text-center">You have no orders yet.</p>
      {% endif %}
    </div>
  </div>
</div>

{% if request.session.order_success %}
<script>
    Swal.fire({
        icon: 'success',
        title: 'Order Placed!',
        text: 'Your order has been placed successfully.',
        confirmButtonColor: '#3085d6',
        confirmButtonText: 'OK'
    });
</script>
{% endif %}
{% endblock %}
