{% extends 'static_pages/base.html' %}
{% load static %}
{% block start %}
<link rel="stylesheet" href="{% static 'css/booking.css' %}">

<div class="booking-wrapper">
  <h2 class="mb-4 text-center">Place Your Mehndi Order</h2>

  <form id="orderForm" action="{% url 'place_order' %}" method="POST">
    {% csrf_token %}
    <div class="row justify-content-center">
      <!-- LEFT SIDE: Customer & Shipping Info -->
      <div class="col-md-6">
        <div class="mb-3">
          <label for="fullname">Full Name *</label>
          <input type="text" class="form-control" id="fullname" name="fullname" required>
        </div>

        <div class="mb-3">
          <label for="contact">Contact Number *</label>
          <input type="tel" class="form-control" id="contact" name="contact" required pattern="[0-9]{10}" placeholder="10-digit number">
        </div>

        <h5 class="mt-4">Shipping Address</h5>
        <div class="mb-3">
          <label for="add1">Address Line 1 *</label>
          <input type="text" class="form-control" id="add1" name="add1" required>
        </div>

        <div class="mb-3">
          <label for="street">Street *</label>
          <input type="text" class="form-control" id="street" name="street" required>
        </div>

        <div class="mb-3">
          <label for="city">City *</label>
          <input type="text" class="form-control" id="city" name="city" required>
        </div>

        <div class="mb-3">
          <label for="zipcode">Zip Code *</label>
          <input type="text" class="form-control" id="zipcode" name="zipcode" required pattern="[0-9]{6}">
        </div>

        <div class="mb-3">
          <label for="county">Country</label>
          <input type="text" class="form-control bg-light" id="county" name="county" value="India" readonly>
        </div>
      </div>

      <!-- RIGHT SIDE: Product Order Summary -->
      <div class="col-md-6" style="color: black;">
        <h5 class="mb-3">Order Summary</h5>
        {% if cart_items %}
          {% for item in cart_items %}
            <div class="d-flex mb-3 align-items-center border p-2 rounded">
              {% if item.product.image %}
                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 60px; height: 60px; object-fit: cover; margin-right: 15px;">
              {% endif %}
              <div class="flex-grow-1">
                <strong>{{ item.product.name }}</strong><br>
                <small>{{ item.product.color }} | Size: {{ item.product.size }}</small><br>
                <span>â‚¹{{ item.product.price }} Ã— {{ item.quantity }}</span>
              </div>
              <div style="min-width: 80px; font-weight: bold; text-align: right; color: #d9534f;">
                â‚¹{{ item.subtotal }}
              </div>
            </div>
          {% endfor %}

          <hr>

          <div class="mb-2 d-flex justify-content-between">
            <span>Total Price:</span>
            <strong>â‚¹{{ total_price }}</strong>
          </div>
          <div class="mb-2 d-flex justify-content-between">
            <span>Shipping Charge:</span>
            <strong>â‚¹{{ shipping_charge }}</strong>
          </div>
          <div class="d-flex justify-content-between" style="font-size: 1.2rem;">
            <span>Final Total:</span>
            <strong style="color: #d9534f;">â‚¹{{ final_total }}</strong>
          </div>

          <!-- Hidden fields to send to backend -->
          <input type="hidden" name="total_price" value="{{ total_price }}">
          <input type="hidden" name="shipping_charge" value="{{ shipping_charge }}">
          <input type="hidden" name="final_total" value="{{ final_total }}">

          <div class="form-check mt-3 mb-3">
            <input class="form-check-input" type="checkbox" id="confirm" required>
            <label class="form-check-label" for="confirm">
              I confirm the above details are correct.
            </label>
          </div>

          <div class="d-flex gap-2 mb-3">
            <a href="{% url 'cart' %}"  class="btn btn-secondary flex-grow-1">Back to Cart</a>
            <button type="submit" class="btn btn-warning flex-grow-1">ðŸ“¦ Place Order</button>
          </div>

        {% else %}
          <p>No items in cart. <a href="{% url 'product_list' %}">Shop now</a></p>
        {% endif %}
      </div>
    </div>
  </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  {% if messages %}
    {% for message in messages %}
      Swal.fire({
        icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% else %}info{% endif %}",
        title: "{{ message.tags|title }}",
        text: "{{ message }}",
      }).then(() => {
        // Optional: Redirect to home if needed
        // window.location.href = "{% url 'home' %}";
      });
    {% endfor %}
  {% endif %}
});
</script>


{% endblock %}
